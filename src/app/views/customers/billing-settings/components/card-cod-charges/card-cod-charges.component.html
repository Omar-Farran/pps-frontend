<div class="c-card mb-4 c-card-hover c-card-branch-inf pb-0">
    <div class="c-card-body">
        <div class="c-header justify-content-center">
            <div class="c-title text-20">COD charges</div>
    
            <div class="c-badge text-success">
                <span>Active</span>
            </div>
            
            <div class="c-actions hover-element">
                <button 
                    type="button" 
                    class="btn btn-rounded btn-secondary"
                    (click)="handleModal(CodChargesModal)"      
                >
                    <i class="i-Pen-5 me-0"></i>
                </button>
            </div>
        </div>

        <div class="c-list gap-3">
            <div class="item-type-1 grid-2x pb-3">
                <div class="box-info">
                    <div class="label">Invoicing frequency:</div>
                    <div class="value">Autoinvoice</div>
                </div>

                <div class="box-info">
                    <div class="label">Invoicing group by:</div>
                    <div class="value">Shipment</div>
                </div>
            </div>

            <div class="item-type-1 grid-2x pb-3">
                <div class="box-info">
                    <div class="label">Calculation triggers:</div>
                    <div class="value">Shipment added to MAWB</div>
                </div>

                <div class="box-info">
                    <div class="label">Invoice triggers:</div>
                    <div class="value">Shipment added to MAWB</div>
                </div>
            </div>
        </div>          
    </div>
</div>

<ng-template #CodChargesModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">COD charges</h4>
        <button style="opacity: 0; pointer-events: none;" ngbAutoFocus></button>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>

    <div class="modal-body">
        <form [formGroup]="codChangesForm" id="codChangesForm" (ngSubmit)="submitCodChargesForm()">
            <div class="row">
                <div class="col-12 col-sm-6 form-group required">
                    <label>Invoicing frequency</label>
                    <select 
                        class="form-control"
                        formControlName="InvoicingFrequency"
                        #InvoicingFrequency
                        (change)="updateRunAt()"
                        [class.is-invalid]="isSubmittedCodChargesForm && codChangesForm.get('InvoicingFrequency')?.errors"
                    >
                        <option value="" disabled selected hidden>Choose frequency</option>
                        <option value="Daily">Daily</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Monthly">Monthly</option>
                    </select>

                    <div class="invalid-feedback">
                        This field is required
                    </div>
                </div>

                <ng-container *ngIf="InvoicingFrequency.value">
                    <div class="col-12 col-sm-6 form-group required">
                        <label>Run at</label>

                        <ng-container *ngIf="InvoicingFrequency.value === 'Daily'">
                            <select 
                                class="form-control"
                                formControlName="RunAt"
                                [class.is-invalid]="isSubmittedCodChargesForm && codChangesForm.get('RunAt')?.errors"
                            >
                                <option value="" disabled selected hidden>Choose time</option>
                                <option value="1">Option 2</option>
                                <option value="2">Option 3</option>
                            </select>
                        </ng-container>

                        <ng-container *ngIf="InvoicingFrequency.value === 'Weekly'">
                            <select 
                                class="form-control"
                                formControlName="RunAt"
                                [class.is-invalid]="isSubmittedCodChargesForm && codChangesForm.get('RunAt')?.errors"
                            >
                                <option value="" disabled selected hidden>Choose day</option>
                                <option value="1">Option 2</option>
                                <option value="2">Option 3</option>
                            </select>
                        </ng-container>

                        <ng-container *ngIf="InvoicingFrequency.value === 'Monthly'">
                            <div class="input-group">
                                <p-calendar 
                                        formControlName="RunAt"
                                        [class.ng-invalid]="isSubmittedCodChargesForm && codChangesForm.get('RunAt')?.errors"
                                        inputStyleClass="form-control" 
                                        readonlyInput="true"
                                        placeholder="dd"
                                        dateFormat="dd"
                                        (onSelect)="onDateChange($event, 'RunAt', 'codChangesForm')"
                                        showClear="true">
                                </p-calendar>
                                <div class="invalid-feedback">This field is required</div>
                                <div class="input-group-append">
                                    <button class="btn"  type="button">
                                        <i class="i-Calendar-4"></i>
                                    </button>
                                </div>
                            </div>
                        </ng-container>
                        
                        <div class="invalid-feedback">
                            This field is required
                        </div>
                    </div>
                </ng-container>

                <div class="col-12 col-sm-6 form-group required">
                    <label>Invoicing group by</label>
                    <select 
                        class="form-control"
                        formControlName="InvoicingGroup"
                        [class.is-invalid]="isSubmittedCodChargesForm && codChangesForm.get('InvoicingGroup')?.errors"
                    >
                        <option value="" disabled selected hidden>Choose group</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                    </select>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                </div>

                <div class="col-12 col-sm-6 form-group">
                    <label>Calculation triggers</label>
                    <select 
                        class="form-control"
                        formControlName="CalculationTriggers"
                    >
                        <option value="" disabled selected hidden>Choose trigger</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                    </select>
                </div>

                <div class="col-12 col-sm-6 form-group">
                    <label>Invoice triggers</label>
                    <select 
                        class="form-control"
                        formControlName="InvoiceTriggers"
                    >
                        <option value="" disabled selected hidden>Choose trigger</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                    </select>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                </div>

                <div class="col-12 col-sm-6 form-group required">
                    <label>Status</label>
                    <select 
                        class="form-control"
                        formControlName="Status"
                        [class.is-invalid]="isSubmittedCodChargesForm && codChangesForm.get('Status')?.errors"
                    >
                        <option value="" disabled selected hidden>Choose status</option>
                        <option value="1">Option 2</option>
                        <option value="2">Option 3</option>
                    </select>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="modal-footer">
        <button 
            type="button" 
            class="btn btn-secondary btn-rounded" 
            (click)="resetCodChargesForm()"
            tabindex="-1"
        >
            Clear fields
        </button>

        <button 
            type="button"
            (click)="submitCodChargesForm()"
            class="btn btn-primary btn-rounded"
            tabindex="-1"
        >
            Save
        </button>
    </div>
</ng-template>